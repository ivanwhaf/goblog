<!DOCTYPE html>
<html lang="en">
<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="这是Ivan的个人博客，以Python、深度学习、数据分析为主">
    <meta name="keywords" content="Ivan、个人博客、Python、深度学习、数据挖掘">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="/static/js/buttons.js"></script>
    <title>
          文件上传 - Ivan | Blog
    </title>
	<link rel="icon" href="/static/photo/1.ico" type="image/x-icon"/>

    <!-- Bootstrap Core CSS -->

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/static/css/beantech.min.css">

    <link rel="stylesheet" href="/static/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/static/css/highlight.css">

    <link rel="stylesheet" href="/static/css/widget.css">

    <link rel="stylesheet" href="/static/css/rocket.css">

    <link rel="stylesheet" href="/static/css/signature.css">

    <link rel="stylesheet" href="/static/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	

	<link rel="stylesheet" href="/static/upload/css/bootstrap2.min.css" >
	<link rel="stylesheet" type="text/css" href="/static/upload/css/default.css"  >
	<link rel="stylesheet" type="text/css" href="/static/upload/css/fileinput.css" media="all"/>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<body ontouchstart="">

<style type="text/css">
    header.intro-header{
            background-image: url('/static/photo/upload.jpg')
            /*page*/
    }  
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="site-heading">
                        <h1>文件上传</h1>
                        <span class="subheading" id="number">文件数量：</span>
                    </div>
                
                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ivan</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                       <li>
                            <a href="/about">About</a>
                        </li>
                        
                        <li>
                            <a href="/archive">Archives</a>
                        </li>
                        
                        <li>
                            <a href="/tags">Tags</a>
                        </li>
                        
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
	
	function download_all()
	{
		r=Math.random().toString(36).slice(-3);
		var xhr = new XMLHttpRequest();
        xhr.open("GET", "/download_all/"+r, true);
        xhr.responseType = "blob";
        xhr.onload = function () {
            if (this.status == 200) {
                var blob = this.response;
                var reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onload = function (e) {
                    var a = document.createElement('a');
					filename='all.zip'		
                    a.download = filename;
                    a.href = e.target.result;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                }
            }
					
		}
		xhr.send();
	}
	
</script>


<div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1" id="ta">
	
			<div class="one-tag-list" id="list_public">
                <span class="fa fa-tag listing-seperator">
                    <span class="tag-text">公共文件列表:</span>
                </span>
            </div>
          
			<!--<div class="form-group">
              <input type="file" name="file" id="file" onchange="viewImg(showimg,this.form.file);">
			  <img width="350px"name="showimg" src="" style="display:none;" alt="暂无图片" /> 
			  <br /> 
            </div>
            -->


			<hr>
			<form  enctype="multipart/form-data"class="probootstrap-form mb60">
				<h4>请选择要上传的公共文件：</h4>
				<div class="form-group">
					<input id="file-1" name="file" type="file" multiple class="file"  data-min-file-count="1">
			</form>

			<button onclick="download_all()">全部下载</button>
			<br><br><br>
			

			<div id="private" hidden>
			<div class="one-tag-list" id="list_private">
                <span class="fa fa-tag listing-seperator">
                    <span class="tag-text">私有文件列表:</span>
                </span>
            </div>
			<hr>
			<form  enctype="multipart/form-data"class="probootstrap-form mb60">
				<h4>请选择要上传的私有文件：</h4>
				<div class="form-group">
					<input id="file-2" name="file" type="file" multiple class="file"  data-min-file-count="1">
			</form>
			</div>

        </div>
    </div>
</div>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                               
                     <li>
                        <a target="_blank" href="https://www.zhihu.com/people/wu-yu-fan-66-20">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
               
		
					<li>
                        <a target="_blank" href="https://weibo.com/u/2438209224">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-spinner fa-spin"><i class="fa fa-weibo fa-stack-1x fa-inverse"></i></i>
                            </span>
                        </a>
                    </li>
                

                    <li>
                        <a target="_blank" href="https://github.com/ivanwhaf">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
				
                <p class="copyright text-muted">
                    Copyright © Ivan 2019 
                    <br>
                    Theme by <a href="http://beantech.org/">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.ivana.work">Ivan</a>

                    <br>
                    苏ICP备19029983号             
                </p>
            </div>
        </div>
    </div>
</footer>


<!-- jQuery -->
<script src="/static/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/static/js/bootstrap.min.js"></script>

<script src="/static/js/hux-blog.min.js"></script>

<script src="/static/upload/js/fileinput.js" type="text/javascript"></script>
<script src="/static/upload/js/fileinput_locale_zh.js" type="text/javascript"></script>

 <script>
    $("#file-1").fileinput({
        uploadUrl: '/upload_file_public', // you must set a valid URL here else you will get an error
        allowedFileExtensions : ['mp4','jpg', 'png','gif','txt','doc','mp3','jpeg','docx','xls','xlsx','ppt','pptx','py','exe','h5','rar','zip','7z'],
        overwriteInitial: false,
        maxFileSize: 300000,
        maxFilesNum: 1,
	});
	
    $("#file-2").fileinput({
        uploadUrl: '/upload_file_private', // you must set a valid URL here else you will get an error
        allowedFileExtensions : ['mp4','jpg', 'png','gif','txt','doc','mp3','jpeg','docx','xls','xlsx','ppt','pptx','py','exe','h5','rar','zip','7z'],
        overwriteInitial: false,
        maxFileSize: 300000,
        maxFilesNum: 1,
	});
    
	function viewImg(img,imgfile) 
	{   
		if(imgfile.files && imgfile.files[0])
		{
			img.src = window.URL.createObjectURL(imgfile.files[0]);
			img.style.display=""; 
			img.border=1; 
		}
		else
		{
			img.src=imgfile.value;
			img.style.display="";
			img.border=1;
		}
	} 
	
	function submitCheck()
	{
		var file=document.getElementById("file-1").files[0];
        if(file==undefined)
        {
            alert("文件不能为空")
            return false;
        }
	}
	
	function delete_file(id)
	{
		var r=confirm("确认删除么？");
		if(r!=true)
		{
			return false;
		}
		$.ajax(
				{
					method:'GET',
					url:'/delete_file?name='+id,
					dataType:'json',
					success:function(data)
						{
							if(data==1)
							{
								alert("删除成功！");
								window.location.href="/upload";
							}
							else if(data==0)
							{
								alert("删除失败！");
							}
							else
							{
								alert("您尚未登录！");
								window.location.href="/login";
							}
						}
				}
		);
		
	}
	
	function get_fileinfo()
	{	
		var path=document.location.toString();
	    $.ajax(
	            {
	                  method: 'GET',
	                  url: '/fileinfo',
					  dataType:'json',
	                  success: function(data) {
							number=data.number;
							login=data.login;
							$("#number").append(number);
							data_public=data.data_public;
							data_private=data.data_private;
							
							for(var key in data_public)
							{
								if(login=='1')
								{
									size=data_public[key];
									$("#list_public").append('<li><a href="/file_public/'+key+'">'+key+' ('+size+')</a>&emsp;<button id="'+key+'" onclick="delete_file(this.id)">删除</button></li>');
								}
								else
								{
									size=data_public[key];
									$("#list_public").append('<li><a href="/file_public/'+key+'">'+key+' ('+size+')</a></li>');
								}
							}
							
							if(login=='1')
							{
								$("#private").show();
								for(var key in data_private)
								{
									size=data_private[key];
									$("#list_private").append('<li><a href="/file_private/'+key+'">'+key+' ('+size+')</a></li>');
								}

							}
							
	                   }
	              }
	          );
	}
	$(document).ready(get_fileinfo());
	

	$('#file-1').on('fileuploaded', function(event, data) {
	 alert("公共文件上传成功!");
     location.reload();
	});
	
	$("#file-2").on('fileuploaded', function(event, data) {
	 alert("私有文件上传成功!");
     location.reload();
	});
	

</script>

<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
-->

	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/static/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/static/js/toc.js?v=1.0.0" async=""></script>

</body>

</html>
